---
title: "Chapter 17, Vignette 1: RSM predicted operating characteristics: lesDist and lesWghtDistr"
author: "Dev P. Chakraborty, PhD"
date: "`r Sys.Date()`"
output: rmarkdown::html_document
bibliography: myRefs.bib
fig_caption: yes
fig.width: 4
vignette: >
  %\VignetteIndexEntry{RSM predicted operating characteristics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
  
```{r setup, include = FALSE}
  knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
  )
  library(RJafroc)
```

## Introduction
* The purpose of this vignette is to explain the operating characteristics predicted by the RSM. It relates to Chapter 17 in my book [@RN2680]. 
* This vignette is under development ...
* Also to explain the difference between `dataset` members `lesionID` and `lesionWeight` and `lesDist` and lesWghtDistr, which do not pertain to any `dataset`. 

## The distinction between predicted curves and empirical curves
* Operating characteristics predicted by a model have zero sampling variability.  
* Empirical operating characteristics, which apply to datasets, have non-zero sampling variability. 
* If the model is corect, as the numbers of cases in the dataset increases, the empirical operating characteristic asymptotically approaches the predicted curve. 

## The RSM model
* The 3 RSM parameters and two additional parameters characterizing the dataset determine the wAFROC curve.
* The 3 RSM parameters are $\mu$, $\lambda$ and $\nu$. 
* The two dataset parameters are:
    + The distribution of number of lesions per diseased case, `lesDist`.
    + The distribution of lesion weights, `lesWghtDistr`.
* These parameters do not apply to individual cases; rather they refer to a large population (asymptotically infinite in size) of cases. 

```{r}
str(dataset04$lesionID)
str(dataset04$lesionWeight)
```

* Note that the first index of both arrays is the case index for the 100 abnormal cases in this dataset. 
* With finite number of cases the empirical operating characteristic (or for that matter any fitted operating characteristic) will have sampling variability as in the following example.

```{r}
p <- PlotEmpiricalOperatingCharacteristics(dataset04, opChType = "wAFROC")
p$Plot
```

* [The plot does not show the error bars - this is left for a future update. Please imagine there are error bars.]
* The smaller the dataset, the larger the error bars.
* In contrast the following code shows a plot without error bars, because it is a model *predicted* plot, not a model *fitted* plot.

```{r}
## Following example is for mu = 2, lambda = 1, nu = 0.6. 20% of the diseased 
## cases have a single lesion, 40% have two lesions, 10% have 3 lesions, 
## and 30% have 4 lesions.  
lesDistr <- rbind(c(1, 0.2), c(2, 0.4), c(3, 0.1), c(4, 0.3))

## On cases with one lesion the weights are 1, on cases with 2 lesions the weights
## are 0.4 and 0.6, on cases with three lesions the weights are 0.2, 0.3 and 0.5, and
## on cases with 4 lesions the weights are 0.3, 0.4, 0.2 and 0.1: 
lesWghtDistr <- rbind(c(1.0, -Inf, -Inf, -Inf), 
                      c(0.4,  0.6, -Inf, -Inf), 
                      c(0.2,  0.3,  0.5, -Inf), 
                      c(0.3,  0.4, 0.2,  0.1))
p <- PlotRsmOperatingCharacteristics(mu = 2, lambda = 1, nu = 0.6,
                                       lesDistr = lesDistr, lesWghtDistr = lesWghtDistr, 
                                       legendPosition = "bottom", nlfRange = c(0, 1), llfRange = c(0, 1))
p$wAFROCPlot
```

```{r}
lesDistr
lesWghtDistr
```

## The distribution of number of lesions per diseased case
* It specifies

## The predicted wAFROC curve
The Excel file has three worsheets. These are named `Truth`, `NL` or `FP` and `LL` or `TP`. 

## Summary  
* The FROC dataset has far less regularity in structure as compared to an ROC dataset.
* The length of the first dimension of either `x$NL` or `x$LL` list members is the total number of modalities, 2 in the current example.
* The length of the second dimension of either `x$NL` or `x$LL` list members is the total number of readers, 3 in the current example.
* The length of the third dimension of `x$NL` is the total number of cases, 8 in the current example. The first three positions account for `NL` marks on non-diseased cases and the remaining 5 positions account for `NL` marks on diseased cases.
* The length of the third dimension of `x$LL` is the total number of diseased cases, 5 in the current example. 
* The length of the fourth dimension of `x$NL` is determined by the case (diseased or non-diseased) with the most `NL` marks, 2 in the current example.
* The length of the fourth dimension of `x$LL` is determined by the diseased case with the most lesions, 3 in the current example.



## References  
